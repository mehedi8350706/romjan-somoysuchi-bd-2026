<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>рж░ржоржЬрж╛ржи рж╕ржорзЯрж╕рзВржЪрж┐</title>

<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
<script src="{{ url_for('static', filename='js/script.js') }}"></script>
</head>

<body class="clean-bg">

<!-- CLOCK -->
<div class="clock" id="clock"></div>

<!-- SELECTED INFO -->
<div class="selected-wrapper">
    <div class="selected-line-1">
        {{ division }} ржмрж┐ржнрж╛ржЧ , {{ district }} ржЬрзЗрж▓рж╛
    </div>

    <div class="selected-line-2">
        ржирж┐рж░рзНржмрж╛ржЪрж┐ржд рждрж╛рж░рж┐ржЦ: {{ date_bn }}
    </div>

    <div class="selected-week">
        ржмрж╛рж░: {{ week }}
    </div>
</div>

<!-- TARABI & ROZA -->
<div class="info-grid">
    <div class="info-box">
        ЁЯМЩ рждрж╛рж░рж╛ржмрж┐: {{ tarabi }} рждржо
    </div>
    <div class="info-box">
        ЁЯХМ рж░рзЛржЬрж╛: {{ roza }} рждржо
    </div>
    <div class="info-box">
        ЁЯМЕ рж╕рзЗрж╣рж░рж┐: {{ sehri }}
        <div class="countdown" data-time="{{ sehri }}"></div>
    </div>
    <div class="info-box">
        ЁЯМЗ ржЗржлрждрж╛рж░: {{ iftar }}
        <div class="countdown" data-time="{{ iftar }}"></div>
    </div>
</div>

<!-- ===== NAMAZ ROW ===== -->
<div class="namaz-row" id="namazRow">

    <div class="namaz-glass" data-waqt="fajr" data-time="{{ fajar_12 }}">
        <h3>ржлржЬрж░</h3>
        <div class="namaz-time">рж╕ржорзЯ: {{ fajar_12 }}</div>
        <div class="namaz-details">
            рж╕рзБржирзНржиржд : рзи рж░рж╛ржХрж╛ржд<br>
            ржлрж░ржЬ : рзи рж░рж╛ржХрж╛ржд (ржнрзЛрж░)
        </div>
        <div class="countdown" data-time="{{ fajar_12 }}"></div>
        <div class="waqt-range"></div>
    </div>

    <div class="namaz-glass" data-waqt="zohor" data-time="{{ zohor_12 }}">
        <h3>ржпрзЛрж╣рж░</h3>
        <div class="namaz-time">рж╕ржорзЯ: {{ zohor_12 }}</div>
        <div class="namaz-details">
            рж╕рзБржирзНржиржд : рзк рж░рж╛ржХрж╛ржд<br>
            ржлрж░ржЬ : рзк рж░рж╛ржХрж╛ржд<br>
            рж╕рзБржирзНржиржд : рзи рж░рж╛ржХрж╛ржд (ржжрзБржкрзБрж░)
        </div>
        <div class="countdown" data-time="{{ zohor_12 }}"></div>
        <div class="waqt-range"></div>
    </div>

    <div class="namaz-glass" data-waqt="asor" data-time="{{ asor_12 }}">
        <h3>ржЖрж╕рж░</h3>
        <div class="namaz-time">рж╕ржорзЯ: {{ asor_12 }}</div>
        <div class="namaz-details">
            ржлрж░ржЬ : рзк рж░рж╛ржХрж╛ржд (ржмрж┐ржХрзЗрж▓)
        </div>
        <div class="countdown" data-time="{{ asor_12 }}"></div>
        <div class="waqt-range"></div>
    </div>

    <div class="namaz-glass" data-waqt="magrib" data-time="{{ magrib_12 }}">
        <h3>ржорж╛ржЧрж░рж┐ржм</h3>
        <div class="namaz-time">рж╕ржорзЯ: {{ magrib_12 }}</div>
        <div class="namaz-details">
            ржлрж░ржЬ : рзй рж░рж╛ржХрж╛ржд<br>
            рж╕рзБржирзНржиржд : рзи рж░рж╛ржХрж╛ржд
        </div>
        <div class="countdown" data-time="{{ magrib_12 }}"></div>
        <div class="waqt-range"></div>
    </div>

    <div class="namaz-glass" data-waqt="esha" data-time="{{ esha_12 }}">
        <h3>ржПрж╢рж╛</h3>
        <div class="namaz-time">рж╕ржорзЯ: {{ esha_12 }}</div>
        <div class="namaz-details">
            ржлрж░ржЬ : рзк рж░рж╛ржХрж╛ржд<br>
            рж╕рзБржирзНржиржд : рзи рж░рж╛ржХрж╛ржд<br>
            ржмрж┐рждрж░ : рзй рж░рж╛ржХрж╛ржд (рж░рж╛ржд)
        </div>
        <div class="countdown" data-time="{{ esha_12 }}"></div>
        <div class="waqt-range"></div>
    </div>

</div>


<div class="footer">
    Developed by Mehedi Hasan
</div>
<script>
// ===== SAFE TIME PARSER (05:16 AM тЖТ minutes) =====
function parseTimeSafe(timeStr) {
    if (!timeStr) return null;

    // Ignore text like "рж╕ржорзЯ рж╢рзЗрж╖ рж╣рзЯрзЗржЫрзЗ"
    if (timeStr.includes("рж╕ржорзЯ") || timeStr.includes("рж╢рзБрж░рзБ")) return null;

    try {
        const parts = timeStr.trim().split(" ");
        if (parts.length < 2) return null;

        let [hour, minute] = parts[0].split(":").map(Number);
        const period = parts[1];

        if (period === "PM" && hour !== 12) hour += 12;
        if (period === "AM" && hour === 12) hour = 0;

        return hour * 60 + minute;
    } catch (e) {
        return null;
    }
}

// ===== GET CURRENT BD TIME (Browser Local) =====
function getNowMinutes() {
    const now = new Date();
    return now.getHours() * 60 + now.getMinutes();
}

// ===== GET TIME FROM DOM =====
function getTime(id) {
    const el = document.getElementById(id);
    if (!el) return null;
    return parseTimeSafe(el.innerText);
}

// ===== HIGHLIGHT CURRENT WAQT =====
function highlightWaqt() {
    const nowMin = getNowMinutes();

    const fajar = getTime("fajar-time");
    const zohor = getTime("zohor-time");
    const asor = getTime("asor-time");
    const magrib = getTime("magrib-time");
    const esha = getTime("esha-time");

    if (fajar === null || zohor === null || asor === null || magrib === null || esha === null) {
        return; // if time text is not valid (past/future page)
    }

    // Remove old highlight
    document.querySelectorAll(".waqt-card").forEach(card => {
        card.classList.remove("active-waqt");
    });

    // Esha (7:45 PM тЖТ Fajar)
    if (nowMin >= esha || nowMin < fajar) {
        document.getElementById("esha-card")?.classList.add("active-waqt");
    }
    // Fajar (Fajar тЖТ Zohor)
    else if (nowMin >= fajar && nowMin < zohor) {
        document.getElementById("fajar-card")?.classList.add("active-waqt");
    }
    // Zohor (Zohor тЖТ Asor)
    else if (nowMin >= zohor && nowMin < asor) {
        document.getElementById("zohor-card")?.classList.add("active-waqt");
    }
    // Asor (Asor тЖТ Magrib/Iftar)
    else if (nowMin >= asor && nowMin < magrib) {
        document.getElementById("asor-card")?.classList.add("active-waqt");
    }
    // Magrib (Iftar тЖТ Esha)
    else if (nowMin >= magrib && nowMin < esha) {
        document.getElementById("magrib-card")?.classList.add("active-waqt");
    }
}

// ===== NEXT WAQT COUNTDOWN (MAIN FIX) =====
function startCountdown() {
    const countdownEl = document.getElementById("countdown");
    if (!countdownEl) return;

    setInterval(() => {
        const now = new Date();
        const nowMin = getNowMinutes();

        const times = [
            { name: "ржлржЬрж░", min: getTime("fajar-time") },
            { name: "ржпрзЛрж╣рж░", min: getTime("zohor-time") },
            { name: "ржЖрж╕рж░", min: getTime("asor-time") },
            { name: "ржорж╛ржЧрж░рж┐ржм", min: getTime("magrib-time") },
            { name: "ржПрж╢рж╛", min: getTime("esha-time") }
        ].filter(t => t.min !== null);

        if (times.length === 0) {
            countdownEl.innerText = "ржЖржЬржХрзЗрж░ рж╕ржорзЯ рж╕ржХрзНрж░рж┐рзЯ ржирзЯ";
            return;
        }

        let next = null;

        // Find next waqt today
        for (let t of times) {
            if (t.min > nowMin) {
                next = t;
                break;
            }
        }

        // If all waqt passed тЖТ next is tomorrow Fajar
        if (!next) {
            next = times[0];
        }

        const target = new Date();
        target.setHours(Math.floor(next.min / 60), next.min % 60, 0, 0);

        if (target <= now) {
            target.setDate(target.getDate() + 1);
        }

        const diff = target - now;

        const hours = Math.floor(diff / (1000 * 60 * 60));
        const minutes = Math.floor((diff / (1000 * 60)) % 60);
        const seconds = Math.floor((diff / 1000) % 60);

        countdownEl.innerText =
            `тП│ ${next.name} рж╢рзБрж░рзБ рж╣рждрзЗ ржмрж╛ржХрж┐: ${hours}ржШ ${minutes}ржорж┐ ${seconds}рж╕рзЗ`;
    }, 1000);
}

// ===== AUTO RUN =====
document.addEventListener("DOMContentLoaded", function () {
    highlightWaqt();        // initial highlight
    startCountdown();       // start countdown
    setInterval(highlightWaqt, 60000); // update highlight every 1 min
});
</script>
</body>
</html>

